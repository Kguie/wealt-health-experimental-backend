# Utiliser l'image officielle de Go
FROM golang:1.21 AS builder

# Définir le répertoire de travail à l'intérieur du conteneur
WORKDIR /app

# Copier les fichiers nécessaires pour le build
COPY go.mod go.sum ./
RUN go mod download

# Copier le reste des fichiers de l'application
COPY . .

# Compiler l'application en un binaire
RUN go build -o api ./main.go 

# ---- Phase d'exécution ----
FROM debian:bullseye-slim

# Définir le répertoire de travail
WORKDIR /app

# Copier le binaire compilé depuis l'étape précédente
COPY --from=builder /app/api /app/api

# Exposer le port sur lequel l'API écoute
EXPOSE 8080

# Définir la commande de démarrage
CMD ["/app/api"]
